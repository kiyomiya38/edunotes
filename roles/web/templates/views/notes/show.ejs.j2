<%- include('../layout', { title: `${n.title} | EduNotes`, body: `
<section class="container">
  <div class="card">
    <a class="muted" href="/notes">ノート一覧へ戻る</a>
    <h1 class="hero__title" style="font-size:2.2rem">${n.title}</h1>
    <div class="meta">
      <span>作成者: ${n.author_email}</span>
      <span>作成日: ${new Date(n.created_at).toLocaleString()}</span>
      <span>更新日: ${new Date(n.updated_at).toLocaleString()}</span>
      ${n.is_public ? '<span class="badge">公開</span>' : ''}
    </div>
    <div class="note-content">
      ${n.body_html}
    </div>
    <div style="margin-top:16px;">
      <a class="btn btn--ghost" href="/notes/${n.id}/edit">ノートを編集</a>
    </div>
  </div>

  <div class="section split">
    <div class="card">
      <h2>タグ</h2>
      ${tags && tags.length ? `
        <div class="pill-group">
          ${tags.map(t => `<span class="badge">#${t.name}</span>`).join(' ')}
        </div>
      ` : `<p class="muted">タグはまだありません。</p>`}
      <form class="form" method="post" action="/notes/${n.id}/tags">
        <input type="hidden" name="_csrf" value="${csrfToken}">
        <label>タグを追加</label>
        <input name="name" placeholder="例: データベース">
        <button class="btn btn--ghost" type="submit">追加</button>
      </form>
    </div>

    <div class="card">
      <h2>コメント</h2>
      ${comments && comments.length ? `
        <ul>
          ${comments.map(c => `
            <li style="margin-bottom:16px;">
              <div class="meta">${c.author_email} · ${new Date(c.created_at).toLocaleString()}</div>
              <div class="note-content">${c.body_html}</div>
            </li>
          `).join('')}
        </ul>
      ` : `<p class="muted">コメントはまだありません。</p>`}
      <form class="form" method="post" action="/notes/${n.id}/comments">
        <input type="hidden" name="_csrf" value="${csrfToken}">
        <label>コメントを書く（Markdown）</label>
        <textarea name="body_md" rows="5" placeholder="気づきや質問を書きましょう..."></textarea>
        <button class="btn btn--primary" type="submit">コメントする</button>
      </form>
    </div>
  </div>
</section>
` }) %>

# generated by Ansible
PORT={{ app_port | default(3000) }}
APP_PORT={{ app_port | default(3000) }}
NODE_ENV=production

# S3 settings
S3_REGION={{ aws_region }}
S3_BUCKET={{ s3_bucket_name | default(lookup('env','S3_BUCKET'), true) | default('edunotes-app-uploads', true) }}
S3_ENDPOINT={{ s3_endpoint | default('', true) }}
S3_FORCE_PATH_STYLE={{ (s3_force_path_style | default(false)) | ternary('true','false') }}
S3_SIGNED_URL_TTL={{ s3_signed_url_ttl | default(900) }}

# uploads
UPLOAD_DIR=/var/edunotes/uploads

# database (optional)
DB_HOST={{ db_host }}
DB_NAME={{ db_name }}
DB_USER={{ db_user }}
DB_PASS='{{ db_pass }}'

# session / redis
SESSION_SECRET="{{ session_secret | default('change_me') }}"
{% set _derived_redis = (
    'redis://:' ~ ( (redis_password | default('')) | urlencode ) ~
    '@' ~ (redis_host | default('')) ~ ':' ~ (redis_port | default(6379)) ~ '/0'
) %}
REDIS_URL="{{ (redis_url | default('', true)) | trim | default(_derived_redis, true) }}"

# postgres 接続URL（パスワードは URL エンコードして確実にRDSへ）
{% set composed_url = 'postgres://' ~ db_user ~ ':' ~ (db_pass | urlencode)
   ~ '@' ~ db_host ~ ':' ~ (db_port | default(5432)) ~ '/' ~ db_name %}
DB_URL={{ db_url | default(composed_url) }}
PGSSLROOTCERT={{ pg_sslrootcert | default('/etc/ssl/certs/rds-global-bundle.pem') }}
PGSSLMODE={{ pg_sslmode | default('verify-full') }}

# --- Docs ---
DOCS_DIR=/opt/edunotes/docs

# --- Admin seeding (初回のみ有効。投入後は空にしてOK) ---
ADMIN_EMAIL={{ admin_email | default('admin@example.com') }}
ADMIN_NAME={{ admin_name | default('Administrator') }}
# ※ seed時のみ使う。以降は空に戻すことを推奨
ADMIN_SEED_PASSWORD={{ admin_seed_password | default('') }}

# --- TLS/DB (RDS の自己署名対策) ---
DB_SSL_REJECT_UNAUTHORIZED="{{ db_ssl_reject_unauthorized | default('false') }}"
RDS_CA_BUNDLE="{{ rds_ca_bundle | default('/etc/ssl/certs/ca-certificates.crt') }}"
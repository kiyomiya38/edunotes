# roles/web/templates/app.env.j2
APP_PORT=3000
NODE_ENV={{ node_env }}

# ---- DB URL ----
DB_URL={{ 
  (db_url | default(
    (db_scheme|default('postgres')) ~ '://' ~
    (db_user|default('edunotes')) ~ ':' ~
    (db_pass|default('REPLACE_DB_PASSWORD') | urlencode) ~ '@' ~
    (db_host|default('REPLACE_DB_HOST')) ~ ':' ~
    (db_port|default(5432)) ~ '/' ~
    (db_name|default('edunotes'))
  ))
}}

# ---- Redis URL ----
{% set _creds = (redis_pass is defined and (redis_pass|length>0)) 
                 | ternary(':' ~ redis_pass | urlencode ~ '@','') -%}
REDIS_URL={{ 
  (redis_url | default(
    'redis://' ~ _creds ~
    (redis_host|default('127.0.0.1')) ~ ':' ~
    (redis_port|default(6379)) ~ '/' ~
    (redis_db|default(0))
  ))
}}

# ---- Storage (S3) ----
STORAGE_MODE=s3
S3_BUCKET={{ s3_bucket }}
S3_REGION={{ s3_region }}
S3_ENDPOINT={{ s3_endpoint }}
S3_FORCE_PATH_STYLE={{ s3_force_path_style }}
S3_SIGNED_URL_TTL={{ s3_signed_url_ttl }}

# ---- Session ----
SESSION_SECRET={{ session_secret | default('change_me') }}

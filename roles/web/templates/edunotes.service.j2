[Unit]
Description=EduNotes App
After=network-online.target nginx.service
Wants=network-online.target
Requires=nginx.service

[Service]
Type=simple
User=edunotes
Group=edunotes
EnvironmentFile=-/etc/edunotes/env
WorkingDirectory=/opt/edunotes
ExecStartPre=/usr/bin/install -d -o edunotes -g edunotes -m 0755 /var/edunotes/uploads
ExecStart=/usr/bin/env node server.js
Restart=always
RestartSec=3
Environment=HOME=/home/edunotes
Environment=NODE_ENV=production
Environment=PORT=3000
Environment=APP_PORT=3000
ExecStartPost=/bin/sleep 3

# ← ここをファイル追記に変更
StandardOutput=append:/var/log/edunotes/app.log
StandardError=append:/var/log/edunotes/app.log

# 重複を整理して一つだけ残す
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
